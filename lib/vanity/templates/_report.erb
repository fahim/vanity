<html>
  <head>
    <title>Vanity Report: <%= Time.now.strftime("%b %d %Y, %I:%M:%P") %></title>
    <style>
      .vanity { margin: 2em auto; width: 100%; font-family: "Helvetica Neue", "Helvetica", "Verdana", sans-serif }
      .vanity h1 { margin: 1em 0; border-bottom: 3px solid #ccc }
      <%= vanity_html_safe(File.read(Vanity.template("vanity.css"))) %>
    </style>
    <script type="text/javascript"><%= vanity_html_safe(File.read(Vanity.template("jquery.min.js"))) %></script>
    <script type="text/javascript"><%= vanity_html_safe(File.read(Vanity.template("flot.min.js"))) %></script>
    <script type="text/javascript"><%= vanity_html_safe(File.read(Vanity.template("jquery.flot.stack.js"))) %></script>
    <script type="text/javascript"><%= vanity_html_safe(File.read(Vanity.template("vanity.js"))) %></script>
    <% if respond_to?(:form_authenticity_token) %><script type="text/javascript">document.auth_token = "<%= form_authenticity_token %>"</script><% end %>
  </head>
  <body>
    <div class="vanity">
      <% widget_types = ['widgets', 'experiments', 'metrics'] %>
      <div class="sidebar">
        <% widget_types.each do |widget_type| %>
          <h4><%= widget_type.capitalize %></h4>
          <ul id="<%= widget_type %>">
            <% Vanity.playground.send(widget_type).each do |id, widget_object| %>
             <li><%= link_to_function widget_object.name, "Vanity.showWidget('#{widget_type}', '#{id}')" %></li>
            <% end %>
          </ul>
        <% end %>
      </div>

      <div class="content">
        <% widget_types.each do |widget_type| count = 0 %>
          <div id="<%= widget_type %>">
            <h2><%= widget_type %></h3>
            <% Vanity.playground.send(widget_type).each do |id, widget_object| %>
              <% if count % 2 == 0 %><div style="overflow:hidden"><% end %>
                <%= render :file => Vanity.template("_#{widget_type.singularize}.erb"), :locals => { :"#{widget_type.singularize}" => widget_object } %>
              <% if count % 2 == 1 %></div><% end %>
              <% count += 1 %>
            <% end %>
          </div>
        <% end %>
      </div>

      <p class="footer">Generated by <a href="http://vanity.labnotes.org">Vanity</a></p>
    </div>
  </body>
</html>
